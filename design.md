# 爻 - 每日抽签应用设计文档

## 1. 项目概述

"爻"是一款简约的每日抽签应用，让用户每天能获得一条独特的签文进行参考。该应用强调简单性和每日限制，确保用户能够专注于每天的一条签文。

## 2. 功能需求

### 2.1 核心功能

1. 每日抽签
   - 用户每天可以抽取一条随机签文
   - 签文从预设的签文库中随机选取
   - 显示签文内容及相关解释

2. 抽签限制
   - 每个设备每天只能抽取一次签文
   - 次日凌晨重置抽签权限
   - 若已抽签，显示今日已抽取的签文

### 2.2 用户界面

1. 主页面
   - 显示是否已抽签的状态
   - 抽签按钮（未抽签时可用）
   - 显示当天的签文（已抽签时显示）
   - 显示剩余可抽签时间

2. 签文展示页面
   - 签文内容
   - 签文解释
   - 分享功能（可选）

## 3. 技术架构

### 3.1 前端技术栈
- React Native / Flutter（跨平台支持）
- Local Storage（存储设备标识和抽签记录）
- 状态管理（Redux/Provider）

### 3.2 后端技术栈
- Node.js + Express
- MongoDB（存储签文数据）
- Redis（缓存和限制控制）

### 3.3 数据结构

1. 签文数据结构
```json
{
  "id": "string",
  "content": "string",
  "explanation": "string",
  "category": "string",
  "tags": ["string"],
  "createTime": "timestamp"
}
```

2. 用户抽签记录
```json
{
  "deviceId": "string",
  "lastDrawTime": "timestamp",
  "lastDrawId": "string"
}
```

## 4. 核心实现细节

### 4.1 设备识别机制
- 使用设备唯一标识符（Device ID）
- 结合本地存储实现设备识别
- 考虑用户隐私，采用加密存储

### 4.2 抽签限制实现
- 使用 Redis 实现分布式限制
- 键值结构：`{deviceId}:lastDraw`
- TTL 设置为当天剩余时间

### 4.3 签文随机算法
- 使用加权随机算法
- 考虑节日特殊签文
- 确保签文分布均匀

## 5. 安全考虑

1. 防作弊机制
   - 服务端验证抽签时间
   - 设备标识加密存储
   - 请求频率限制

2. 数据安全
   - HTTPS 传输
   - 签文数据加密存储
   - 用户设备信息脱敏

## 6. 扩展功能（可选）

1. 签文收藏
   - 允许用户收藏喜欢的签文
   - 查看历史抽签记录

2. 社交分享
   - 分享当日签文到社交媒体
   - 生成分享图片

3. 节日特殊签文
   - 特定节日特殊签文池
   - 节日主题界面

## 7. 后续优化方向

1. 性能优化
   - 签文缓存机制
   - 启动速度优化
   - 网络请求优化

2. 用户体验
   - 抽签动画效果
   - 深色模式支持
   - 离线模式支持

## 8. 签文管理

### 8.1 签文文件格式
```json
{
  "signs": [
    {
      "id": "001",
      "content": "签文内容",
      "explanation": "解释",
      "category": "类别",
      "tags": ["吉", "事业"]
    }
  ]
}
```

### 8.2 签文更新机制
- 版本控制
- 增量更新
- 本地缓存

## 9. 项目时间线

1. 第一阶段（2周）
   - 基础架构搭建
   - 核心抽签功能实现

2. 第二阶段（2周）
   - 用户界面开发
   - 签文数据库建设

3. 第三阶段（1周）
   - 测试和优化
   - 上线准备

## 10. 监控和维护

1. 性能监控
   - 服务器负载
   - 响应时间
   - 错误率

2. 用户数据分析
   - 使用频率
   - 留存率
   - 签文分布